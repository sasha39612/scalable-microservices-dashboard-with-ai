# Use Node.js 20 Alpine as base
FROM node:20-alpine

# Upgrade busybox to fix security vulnerabilities
RUN apk upgrade --no-cache busybox busybox-binsh ssl_client

# Install pnpm globally
RUN npm install -g pnpm

# Set working directory
WORKDIR /app

# Configure Next.js
ENV NEXT_TELEMETRY_DISABLED=1
ENV NODE_ENV=development

# Copy package files
COPY frontend/package.json ./package.json
COPY frontend/tsconfig.json ./tsconfig.json
COPY frontend/next.config.mjs ./next.config.mjs
COPY frontend/postcss.config.mjs ./postcss.config.mjs
COPY frontend/tailwind.config.ts ./tailwind.config.ts

# Install dependencies
RUN pnpm install

# Copy the rest of the application
COPY frontend/app ./app
COPY frontend/components ./components
COPY frontend/hooks ./hooks
COPY frontend/styles ./styles
COPY frontend/tests ./tests
COPY frontend/utils ./utils

# Expose port for Next.js
EXPOSE 3000

# Start development server
CMD ["pnpm", "dev"]
